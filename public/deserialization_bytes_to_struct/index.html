<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
    <title>如何将字节序列反序列化成结构 :: Inkwell</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content=" 反序列化在计算机领域通常指的是将序列化的数据，例如 JSON、XML 或者二进制格式重新转换为程序可操作的对象或数据结构的过程。
我最近正在尝试自己写一个简单的 DNS 实现。总所周知，DNS 的报文是以字节序列进行传输的，传输层采用 UDP 协议。一个 DNS 报文的标准格式是下面这样的：
1 2 3 4 0 1 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 按照 RFC 1035 格式进行解析：
0-1 - ID 0x1234 -&gt; 4660 2-3 - Flags 01 00 &#43;--&#43;-------&#43;--&#43;--&#43;--&#43;--&#43;---&#43;-----&#43; |QR|OPCODE |AA|TC|RD|RA|Z |RCODE| &#43;--&#43;-------&#43;--&#43;--&#43;--&#43;--&#43;---&#43;-----&#43; | 0|0000 |0 |0 |1 |0 |000|0000 | &#43;--&#43;-------&#43;--&#43;--&#43;--&#43;--&#43;---&#43;-----&#43; =&gt; QR = 0 (query) =&gt; OPCODE = 0000 (standart query) =&gt; AA = 0 =&gt; TC = 0 =&gt; RD = 1 (recursion desired) =&gt; RA = 0 =&gt; Z = 000 =&gt; QCODE = 0000 4-5 - QDCOUNT 00 01 -&gt; 1 6-7 - ANCOUNT 00 00 -&gt; 0 8-9 - NSCOUNT 00 00 -&gt; 0 10-11 - ARCOUNT 00 00 -&gt; 0 RFC 1035 1 1 1 1 1 1 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; | ID | &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; |QR| Opcode |AA|TC|RD|RA| Z | RCODE | &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; | QDCOUNT | &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; | ANCOUNT | &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; | NSCOUNT | &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; | ARCOUNT | &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; where: ID A 16 bit identifier assigned by the program that generates any kind of query. This identifier is copied the corresponding reply and can be used by the requester to match up replies to outstanding queries. QR A one bit field that specifies whether this message is a query (0), or a response (1). OPCODE A four bit field that specifies kind of query in this message. This value is set by the originator of a query and copied into the response. The values are: 0 a standard query (QUERY) 1 an inverse query (IQUERY) 2 a server status request (STATUS) 3-15 reserved for future use AA Authoritative Answer - this bit is valid in responses, and specifies that the responding name server is an authority for the domain name in question section. Note that the contents of the answer section may have multiple owner names because of aliases. The AA bit corresponds to the name which matches the query name, or the first owner name in the answer section. TC TrunCation - specifies that this message was truncated due to length greater than that permitted on the transmission channel. RD Recursion Desired - this bit may be set in a query and is copied into the response. If RD is set, it directs the name server to pursue the query recursively. Recursive query support is optional. RA Recursion Available - this be is set or cleared in a response, and denotes whether recursive query support is available in the name server. Z Reserved for future use. Must be zero in all queries and responses. RCODE Response code - this 4 bit field is set as part of responses. The values have the following interpretation: 0 No error condition 1 Format error - The name server was unable to interpret the query. 2 Server failure - The name server was unable to process this query due to a problem with the name server. 3 Name Error - Meaningful only for responses from an authoritative name server, this code signifies that the domain name referenced in the query does not exist. 4 Not Implemented - The name server does not support the requested kind of query. 5 Refused - The name server refuses to perform the specified operation for policy reasons. For example, a name server may not wish to provide the information to the particular requester, or a name server may not wish to perform a particular operation (e.g., zone transfer) for particular data. 6-15 Reserved for future use. QDCOUNT an unsigned 16 bit integer specifying the number of entries in the question section. ANCOUNT an unsigned 16 bit integer specifying the number of resource records in the answer section. NSCOUNT an unsigned 16 bit integer specifying the number of name server resource records in the authority records section. ARCOUNT an unsigned 16 bit integer specifying the number of resource records in the additional records section. RFC 1035 中对报文的结构进行了规定，基于这个规定我们可以在 Golang 中进行反序列化。
" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="http://localhost:1313/deserialization_bytes_to_struct/" />





  
  <link rel="stylesheet" href="http://localhost:1313/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="shortcut icon" href="http://localhost:1313/favicon.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="如何将字节序列反序列化成结构">
<meta property="og:description" content=" 反序列化在计算机领域通常指的是将序列化的数据，例如 JSON、XML 或者二进制格式重新转换为程序可操作的对象或数据结构的过程。
我最近正在尝试自己写一个简单的 DNS 实现。总所周知，DNS 的报文是以字节序列进行传输的，传输层采用 UDP 协议。一个 DNS 报文的标准格式是下面这样的：
1 2 3 4 0 1 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 按照 RFC 1035 格式进行解析：
0-1 - ID 0x1234 -&gt; 4660 2-3 - Flags 01 00 &#43;--&#43;-------&#43;--&#43;--&#43;--&#43;--&#43;---&#43;-----&#43; |QR|OPCODE |AA|TC|RD|RA|Z |RCODE| &#43;--&#43;-------&#43;--&#43;--&#43;--&#43;--&#43;---&#43;-----&#43; | 0|0000 |0 |0 |1 |0 |000|0000 | &#43;--&#43;-------&#43;--&#43;--&#43;--&#43;--&#43;---&#43;-----&#43; =&gt; QR = 0 (query) =&gt; OPCODE = 0000 (standart query) =&gt; AA = 0 =&gt; TC = 0 =&gt; RD = 1 (recursion desired) =&gt; RA = 0 =&gt; Z = 000 =&gt; QCODE = 0000 4-5 - QDCOUNT 00 01 -&gt; 1 6-7 - ANCOUNT 00 00 -&gt; 0 8-9 - NSCOUNT 00 00 -&gt; 0 10-11 - ARCOUNT 00 00 -&gt; 0 RFC 1035 1 1 1 1 1 1 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; | ID | &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; |QR| Opcode |AA|TC|RD|RA| Z | RCODE | &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; | QDCOUNT | &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; | ANCOUNT | &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; | NSCOUNT | &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; | ARCOUNT | &#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43;--&#43; where: ID A 16 bit identifier assigned by the program that generates any kind of query. This identifier is copied the corresponding reply and can be used by the requester to match up replies to outstanding queries. QR A one bit field that specifies whether this message is a query (0), or a response (1). OPCODE A four bit field that specifies kind of query in this message. This value is set by the originator of a query and copied into the response. The values are: 0 a standard query (QUERY) 1 an inverse query (IQUERY) 2 a server status request (STATUS) 3-15 reserved for future use AA Authoritative Answer - this bit is valid in responses, and specifies that the responding name server is an authority for the domain name in question section. Note that the contents of the answer section may have multiple owner names because of aliases. The AA bit corresponds to the name which matches the query name, or the first owner name in the answer section. TC TrunCation - specifies that this message was truncated due to length greater than that permitted on the transmission channel. RD Recursion Desired - this bit may be set in a query and is copied into the response. If RD is set, it directs the name server to pursue the query recursively. Recursive query support is optional. RA Recursion Available - this be is set or cleared in a response, and denotes whether recursive query support is available in the name server. Z Reserved for future use. Must be zero in all queries and responses. RCODE Response code - this 4 bit field is set as part of responses. The values have the following interpretation: 0 No error condition 1 Format error - The name server was unable to interpret the query. 2 Server failure - The name server was unable to process this query due to a problem with the name server. 3 Name Error - Meaningful only for responses from an authoritative name server, this code signifies that the domain name referenced in the query does not exist. 4 Not Implemented - The name server does not support the requested kind of query. 5 Refused - The name server refuses to perform the specified operation for policy reasons. For example, a name server may not wish to provide the information to the particular requester, or a name server may not wish to perform a particular operation (e.g., zone transfer) for particular data. 6-15 Reserved for future use. QDCOUNT an unsigned 16 bit integer specifying the number of entries in the question section. ANCOUNT an unsigned 16 bit integer specifying the number of resource records in the answer section. NSCOUNT an unsigned 16 bit integer specifying the number of name server resource records in the authority records section. ARCOUNT an unsigned 16 bit integer specifying the number of resource records in the additional records section. RFC 1035 中对报文的结构进行了规定，基于这个规定我们可以在 Golang 中进行反序列化。
" />
<meta property="og:url" content="http://localhost:1313/deserialization_bytes_to_struct/" />
<meta property="og:site_name" content="Inkwell" />

  <meta property="og:image" content="http://localhost:1313/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2025-11-28 11:06:03 &#43;0800 CST" />












</head>
<body>


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="http://localhost:1313/">
  <div class="logo">
    Terminal
  </div>
</a>

    </div>
    
    
  </div>
  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="http://localhost:1313/deserialization_bytes_to_struct/">如何将字节序列反序列化成结构</a>
  </h1>
  <div class="post-meta"><time class="post-date">2025-11-28</time></div>

  
  


  

  <div class="post-content"><div>
        <blockquote>
<p>反序列化在计算机领域通常指的是将序列化的数据，例如 JSON、XML 或者二进制格式重新转换为程序可操作的对象或数据结构的过程。</p>
</blockquote>
<p>我最近正在尝试自己写一个简单的 DNS 实现。总所周知，DNS 的报文是以字节序列进行传输的，传输层采用 UDP 协议。一个 DNS 报文的标准格式是下面这样的：</p>



<div class="goat svg-container ">
  
    <svg
      xmlns="http://www.w3.org/2000/svg"
      font-family="Menlo,Lucida Console,monospace"
      
        viewBox="0 0 288 25"
      >
      <g transform='translate(8,16)'>
<text text-anchor='middle' x='0' y='4' fill='currentColor' style='font-size:1em'>1</text>
<text text-anchor='middle' x='8' y='4' fill='currentColor' style='font-size:1em'>2</text>
<text text-anchor='middle' x='24' y='4' fill='currentColor' style='font-size:1em'>3</text>
<text text-anchor='middle' x='32' y='4' fill='currentColor' style='font-size:1em'>4</text>
<text text-anchor='middle' x='48' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='56' y='4' fill='currentColor' style='font-size:1em'>1</text>
<text text-anchor='middle' x='72' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='80' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='96' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='104' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='120' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='128' y='4' fill='currentColor' style='font-size:1em'>1</text>
<text text-anchor='middle' x='144' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='152' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='168' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='176' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='192' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='200' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='216' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='224' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='240' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='248' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='264' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='272' y='4' fill='currentColor' style='font-size:1em'>0</text>
</g>

    </svg>
  
</div>
<p>按照 RFC 1035 格式进行解析：</p>
<pre tabindex="0"><code>0-1    -   ID         0x1234 -&gt;  4660

2-3    -   Flags      01 00
           +--+-------+--+--+--+--+---+-----+
           |QR|OPCODE |AA|TC|RD|RA|Z  |RCODE|
           +--+-------+--+--+--+--+---+-----+
           | 0|0000   |0 |0 |1 |0 |000|0000 |
           +--+-------+--+--+--+--+---+-----+
           =&gt; QR     = 0    (query)
           =&gt; OPCODE = 0000 (standart query)
           =&gt; AA     = 0
           =&gt; TC     = 0
           =&gt; RD     = 1    (recursion desired)
           =&gt; RA     = 0
           =&gt; Z      = 000
           =&gt; QCODE  = 0000

4-5    -   QDCOUNT    00 01  -&gt;  1

6-7    -   ANCOUNT    00 00  -&gt;  0

8-9    -   NSCOUNT    00 00  -&gt;  0

10-11  -   ARCOUNT    00 00  -&gt;  0
</code></pre>
<details>
  <summary>RFC 1035</summary>
  <pre tabindex="0"><code>
                                    1  1  1  1  1  1
      0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                      ID                       |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |QR|   Opcode  |AA|TC|RD|RA|   Z    |   RCODE   |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    QDCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    ANCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    NSCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    ARCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

ID              A 16 bit identifier assigned by the program that
                generates any kind of query.  This identifier is copied
                the corresponding reply and can be used by the requester
                to match up replies to outstanding queries.

QR              A one bit field that specifies whether this message is a
                query (0), or a response (1).

OPCODE          A four bit field that specifies kind of query in this
                message.  This value is set by the originator of a query
                and copied into the response.  The values are:

                0               a standard query (QUERY)

                1               an inverse query (IQUERY)

                2               a server status request (STATUS)

                3-15            reserved for future use

AA              Authoritative Answer - this bit is valid in responses,
                and specifies that the responding name server is an
                authority for the domain name in question section.

                Note that the contents of the answer section may have
                multiple owner names because of aliases.  The AA bit
                corresponds to the name which matches the query name, or
                the first owner name in the answer section.

TC              TrunCation - specifies that this message was truncated
                due to length greater than that permitted on the
                transmission channel.

RD              Recursion Desired - this bit may be set in a query and
                is copied into the response.  If RD is set, it directs
                the name server to pursue the query recursively.
                Recursive query support is optional.

RA              Recursion Available - this be is set or cleared in a
                response, and denotes whether recursive query support is
                available in the name server.

Z               Reserved for future use.  Must be zero in all queries
                and responses.

RCODE           Response code - this 4 bit field is set as part of
                responses.  The values have the following
                interpretation:

                0               No error condition

                1               Format error - The name server was
                                unable to interpret the query.

                2               Server failure - The name server was
                                unable to process this query due to a
                                problem with the name server.

                3               Name Error - Meaningful only for
                                responses from an authoritative name
                                server, this code signifies that the
                                domain name referenced in the query does
                                not exist.

                4               Not Implemented - The name server does
                                not support the requested kind of query.

                5               Refused - The name server refuses to
                                perform the specified operation for
                                policy reasons.  For example, a name
                                server may not wish to provide the
                                information to the particular requester,
                                or a name server may not wish to perform
                                a particular operation (e.g., zone
                                transfer) for particular data.
                6-15            Reserved for future use.

QDCOUNT         an unsigned 16 bit integer specifying the number of
                entries in the question section.

ANCOUNT         an unsigned 16 bit integer specifying the number of
                resource records in the answer section.

NSCOUNT         an unsigned 16 bit integer specifying the number of name
                server resource records in the authority records
                section.

ARCOUNT         an unsigned 16 bit integer specifying the number of
                resource records in the additional records section.
</code></pre></details>

<p>RFC 1035 中对报文的结构进行了规定，基于这个规定我们可以在 Golang 中进行反序列化。</p>
<p>下文中的代码使用 ChatGPT 生成。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Header</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ID</span>              <span style="color:#66d9ef">uint16</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Flags</span>           <span style="color:#66d9ef">uint16</span> <span style="color:#75715e">// better way is define a Flags structure</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">QuestionCount</span>   <span style="color:#66d9ef">uint16</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">AnswerCount</span>     <span style="color:#66d9ef">uint16</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">authorityCount</span>  <span style="color:#66d9ef">uint16</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">additionalCount</span> <span style="color:#66d9ef">uint16</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">ParseDNSHeader</span>(<span style="color:#a6e22e">data</span> []<span style="color:#66d9ef">byte</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">DNSHeader</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">data</span>) &lt; <span style="color:#ae81ff">12</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;dns header must be 12 bytes&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">h</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">DNSHeader</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ID</span>:      <span style="color:#a6e22e">binary</span>.<span style="color:#a6e22e">BigEndian</span>.<span style="color:#a6e22e">Uint16</span>(<span style="color:#a6e22e">data</span>[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">2</span>]),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Flags</span>:   <span style="color:#a6e22e">binary</span>.<span style="color:#a6e22e">BigEndian</span>.<span style="color:#a6e22e">Uint16</span>(<span style="color:#a6e22e">data</span>[<span style="color:#ae81ff">2</span>:<span style="color:#ae81ff">4</span>]),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">QDCount</span>: <span style="color:#a6e22e">binary</span>.<span style="color:#a6e22e">BigEndian</span>.<span style="color:#a6e22e">Uint16</span>(<span style="color:#a6e22e">data</span>[<span style="color:#ae81ff">4</span>:<span style="color:#ae81ff">6</span>]),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ANCount</span>: <span style="color:#a6e22e">binary</span>.<span style="color:#a6e22e">BigEndian</span>.<span style="color:#a6e22e">Uint16</span>(<span style="color:#a6e22e">data</span>[<span style="color:#ae81ff">6</span>:<span style="color:#ae81ff">8</span>]),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">NSCount</span>: <span style="color:#a6e22e">binary</span>.<span style="color:#a6e22e">BigEndian</span>.<span style="color:#a6e22e">Uint16</span>(<span style="color:#a6e22e">data</span>[<span style="color:#ae81ff">8</span>:<span style="color:#ae81ff">10</span>]),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ARCount</span>: <span style="color:#a6e22e">binary</span>.<span style="color:#a6e22e">BigEndian</span>.<span style="color:#a6e22e">Uint16</span>(<span style="color:#a6e22e">data</span>[<span style="color:#ae81ff">10</span>:<span style="color:#ae81ff">12</span>]),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">h</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ===&gt; 用例 &lt;===</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">raw</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">byte</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x12</span>, <span style="color:#ae81ff">0x34</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ParseDNSHeader</span>(<span style="color:#a6e22e">raw</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%+v\n&#34;</span>, <span style="color:#a6e22e">h</span>)
</span></span></code></pre></div><p>总而言之，字节序列中的数据是按照顺序排列的，Golang 可以通过 <code>[]byte</code> 保存字节序列，约定好结构和成员所占据的字节长度之后就可以将序列切割成多个片，结构成员取字节序列中对应位置的数据即可。</p>

      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2026 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
